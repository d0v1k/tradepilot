{% macro format_duration(seconds) %}
    {% if seconds is not none %}
        {% set days = seconds // 86400 %}
        {% set hours = (seconds % 86400) // 3600 %}
        {% set minutes = (seconds % 3600) // 60 %}
        {% set seconds = seconds % 60 %}
        {{ days }} days, {{ '%02d' % hours }}:{{ '%02d' % minutes }}:{{ '%02d' % seconds }}
    {% else %}
        N/A
    {% endif %}
{% endmacro %}

<!DOCTYPE html>
<html lang="en">
{% include 'head.html' %}
<body class="bg-gray-100">

    {% include 'header.html' %}

    <div class="flex flex-col md:flex-row">
        {% include 'left_column.html' %}
        <main class="flex-1 bg-gray-50 p-6">
            <div class="container mx-auto p-6 shadow-md rounded-lg border border-gray-300">
                <h2 class="text-2xl font-semibold mb-6">My Trades</h2>
                
                <!-- Date Filter Form -->
                <form method="POST" class="mb-6">
                    <div class="flex items-center">
                        <label for="start_date" class="mr-2">Start Date:</label>
                        <input type="date" id="start_date" name="start_date" class="border p-2 mr-4">
                        <label for="end_date" class="mr-2">End Date:</label>
                        <input type="date" id="end_date" name="end_date" class="border p-2 mr-4">
                        <button type="submit" class="bg-blue-600 text-white py-2 px-4 rounded">Filter</button>
                    </div>
                </form>

                <table class="table-auto w-full bg-white shadow-lg text-xs">
                    <thead>
                        <tr class="bg-gray-200">
                            <th class="px-2 py-1">Ticket</th>
                            <th class="px-2 py-1">Open Time</th>
                            <th class="px-2 py-1">Type</th>
                            <th class="px-2 py-1">Size</th>
                            <th class="px-2 py-1">Item</th>
                            <th class="px-2 py-1">Price</th>
                            <th class="px-2 py-1">S/L</th>
                            <th class="px-2 py-1">T/P</th>
                            <th class="px-2 py-1">Close Time</th>
                            <th class="px-2 py-1">Close Price</th>
                            <th class="px-2 py-1">Comm</th>
                            <th class="px-2 py-1">Taxes</th>
                            <th class="px-2 py-1">Swap</th>
                            <th class="px-2 py-1">Profit</th>
                            <th class="px-2 py-1">Pips</th>
                            <th class="px-2 py-1">Duration</th>
                            <th class="px-2 py-1">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for trade in trades %}
                        <tr>
                            <td class="border px-2 py-1 font-medium">{{ trade.ticket }}</td>
                            <td class="border px-2 py-1 font-medium">{{ trade.open_time }}</td>
                            <td class="border px-2 py-1 {% if trade.trade_type == 'Buy' %}text-green-500 font-semibold{% else %}text-red-500 font-semibold{% endif %}">{{ trade.trade_type }}</td>
                            <td class="border px-2 py-1 font-semibold">{{ trade.size }}</td>
                            <td class="border px-2 py-1 font-medium">{{ trade.item }}</td>
                            <td class="border px-2 py-1 font-medium">{{ trade.price }}</td>
                            <td class="border px-2 py-1 font-medium">{{ trade.s_l }}</td>
                            <td class="border px-2 py-1 font-medium">{{ trade.t_p }}</td>
                            <td class="border px-2 py-1 font-medium">{{ trade.close_time }}</td>
                            <td class="border px-2 py-1 font-medium">{{ trade.close_price }}</td>
                            <td class="border px-2 py-1 font-medium">{{ trade.comm }}</td>
                            <td class="border px-2 py-1 font-medium">{{ trade.taxes }}</td>
                            <td class="border px-2 py-1 font-medium">{{ trade.swap }}</td>
                            <td class="border px-2 py-1 {% if trade.profit >= 0 %}text-green-500 font-medium{% else %}text-red-500 font-medium{% endif %}">{{ trade.profit }}</td>
                            <td class="border px-2 py-1 font-medium">{{ trade.pips }}</td>
                            <td class="border px-2 py-1 font-medium">{{ trade.duration }}</td>
                            <td class="border px-2 py-1 flex items-center justify-center">
                                <a href="{{ url_for('edit_trade', trade_id=trade.id) }}" class="text-yellow-500 px-2 py-1 rounded">
                                    <span class="material-icons">edit</span>
                                </a>
                                <a href="{{ url_for('view_trade', trade_id=trade.id) }}" class="text-blue-500 px-2 py-1 rounded">
                                    <span class="material-icons">visibility</span>
                                </a>
                                <form method="POST" action="{{ url_for('delete_trade', trade_id=trade.id) }}" onsubmit="return confirm('Are you sure you want to delete this trade?');">
                                    <button type="submit" class="text-red-600 px-2 py-1 rounded">
                                        <span class="material-icons">delete</span>
                                    </button>
                                </form>
                            </td>                 
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </main>
    </div>
</body>
</html>
